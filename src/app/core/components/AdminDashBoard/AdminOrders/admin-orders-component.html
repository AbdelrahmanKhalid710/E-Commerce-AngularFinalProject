<div class="admin-page-header">
  <h2>Orders Management</h2>
  <div class="admin-stats">
    <span class="admin-stat-badge">Total Orders: {{ totalOrders }}</span>
    <span class="admin-stat-badge">Revenue: EGP {{ getTotalRevenue() }}</span>
    <span class="admin-stat-badge">Page: {{ currentPage }} of {{ totalPages }}</span>
  </div>
</div>

<div class="admin-table-container card">
  <div class="admin-table-header">
    <h3>All Orders ({{ totalOrders }} total)</h3>
    <div class="admin-table-actions">
      <button class="btn-admin-refresh" (click)="loadAdminOrders()">
        <i class="fas fa-sync-alt"></i>
        Refresh
      </button>
    </div>
  </div>

<<<<<<< HEAD
  <!-- Enhanced table with modern syntax -->
=======
  <!-- Modern Angular table -->
>>>>>>> main
  <div class="table-responsive">
    <table class="admin-data-table">
      <thead>
        <tr>
          <th class="col-order-id">Order ID</th>
          <th class="col-customer">Customer</th>
          <th class="col-address">Location</th>
          <th class="col-items">Items</th>
          <th class="col-total">Total</th>
          <th class="col-payment">Payment</th>
          <th class="col-status">Status</th>
          <th class="col-date">Date</th>
        </tr>
      </thead>

      <tbody>
        @for (order of adminOrders; track order._id; let i = $index) {
          <tr [class.even-row]="i % 2 === 0">
            <td class="admin-order-id">
              <div class="order-id-wrapper">
                <span class="order-hash">#</span>
                {{ order._id?.slice(-8) || 'N/A' }}
              </div>
            </td>

            <!-- Customer -->
            <td class="customer-cell">
              <div class="admin-user-info-small">
                <div class="admin-user-name">{{ order.user?.name || 'Guest' }}</div>
                <div class="admin-user-email">{{ order.user?.email || 'No email' }}</div>
                <div class="admin-user-phone">{{ order.user?.phone || 'No Phone' }}</div>
              </div>
            </td>

            <!-- Address -->
            <td class="address-cell">
              <div class="address-details">
                <div class="city-name">
                  <i class="fas fa-map-marker-alt location-icon"></i>
                  {{ order.shippingAddress?.city || 'Not mentioned' }}
                </div>
              </div>
            </td>

            <!-- Items -->
            <td class="items-cell">
              <div class="items-count">
                <span class="items-badge">{{ order.cartItems?.length || 0 }}</span>
                <span class="items-text">items</span>
              </div>
            </td>

            <!-- Total -->
            <td class="total-cell">
              <div class="total-amount">
                <span class="currency">EGP</span>
                <span class="amount">{{ order.totalOrderPrice }}</span>
              </div>
            </td>

            <!-- Payment -->
            <td class="payment-cell">
              <div class="payment-info">
                <span [class]="'admin-payment-method admin-payment-' + order.paymentMethodType">
                  {{ order.paymentMethodType | titlecase }}
                </span>
                <div
                  class="payment-status"
                  [class.paid]="order.isPaid"
                  [class.unpaid]="!order.isPaid"
                >
                  <span
                    class="status-dot"
                    [class.paid-dot]="order.isPaid"
                    [class.unpaid-dot]="!order.isPaid"
                  ></span>
                  {{ order.isPaid ? 'Paid' : 'Unpaid' }}
                </div>
              </div>
            </td>

            <!-- Status -->
            <td class="status-cell">
              <span [class]="'admin-order-status admin-order-status-' + getOrderStatus(order)">
                {{ getOrderStatus(order) | titlecase }}
              </span>
            </td>

            <!-- Date -->
            <td class="date-cell">
              <div class="order-date">
                <div class="date-short">{{ order.createdAt | date: 'MMM dd' }}</div>
                <div class="time-short">{{ order.createdAt | date: 'HH:mm' }}</div>
              </div>
            </td>
        }
        
        <!-- Loading State -->
        @if (adminLoading && adminOrders.length === 0) {
          <tr>
            <td colspan="9">
              <div class="admin-loading">
                <div class="loading-content">
                  <div class="admin-loading-spinner"></div>
                  <div class="loading-text">Loading Orders...</div>
                  <div class="loading-subtext">Please wait while we fetch the latest data</div>
                </div>
              </div>
            </td>
          </tr>
        }
        
        <!-- Empty State -->
        @if (!adminLoading && adminOrders.length === 0) {
          <tr>
            <td colspan="9">
              <div class="admin-empty">
                <div class="empty-content">
                  <i class="fas fa-box-open empty-icon"></i>
                  <div class="empty-text">No Orders Found</div>
                  <div class="empty-subtext">There are no orders to display at the moment</div>
                </div>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  @if (totalPages > 1) {
    <div class="admin-pagination">
      <div class="pagination-controls">
        <button
          class="btn-pagination btn-prev"
          [disabled]="currentPage === 1"
          (click)="goToPage(currentPage - 1)"
        >
          <i class="fas fa-chevron-left"></i>
          Previous
        </button>

        <div class="pagination-info">
          Page <strong>{{ currentPage }}</strong> of <strong>{{ totalPages }}</strong>
        </div>

        <button
          class="btn-pagination btn-next"
          [disabled]="currentPage === totalPages"
          (click)="goToPage(currentPage + 1)"
        >
          Next
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  }

  <!-- Error State -->
  @if (adminError) {
    <div class="admin-error">
      <div class="error-content">
        <i class="fas fa-exclamation-triangle error-icon"></i>
        <div class="error-text">{{ adminError }}</div>
        <button class="btn-admin-retry" (click)="loadAdminOrders()">
          <i class="fas fa-redo retry-icon"></i>
          Try Again
        </button>
      </div>
    </div>
  }
</div>